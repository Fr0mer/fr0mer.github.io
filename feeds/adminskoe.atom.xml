<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>My Blog - Админское</title><link href="fromer.ru/" rel="alternate"></link><link href="fromer.ru/feeds/adminskoe.atom.xml" rel="self"></link><id>fromer.ru/</id><updated>2015-12-12T12:43:00+03:00</updated><entry><title>Заметки о виртуализации</title><link href="fromer.ru/vsphere.html" rel="alternate"></link><published>2015-12-12T12:43:00+03:00</published><updated>2015-12-12T12:43:00+03:00</updated><author><name>Fr0mer</name></author><id>tag:None,2015-12-12:fromer.ru/vsphere.html</id><summary type="html">&lt;p&gt;&lt;img alt="Vmware Logo" src="fromer.ru/images/vmware.png"&gt;&lt;/p&gt;
&lt;p&gt;Волею случая (а точнее по желанию вышестоящего начальства) перепал нам в отдел кластер виртуализации. Мы конечно же обрадовались, выбросили все свои древние сервера и давай безудержно переносить инфраструктуру на платформу виртуализации, пританцовывая джигу и напевая «Ah, du lieber Augustin…»
На самом деле нет — мы неохотно и осторожно — ну и консерваторы …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="Vmware Logo" src="fromer.ru/images/vmware.png"&gt;&lt;/p&gt;
&lt;p&gt;Волею случая (а точнее по желанию вышестоящего начальства) перепал нам в отдел кластер виртуализации. Мы конечно же обрадовались, выбросили все свои древние сервера и давай безудержно переносить инфраструктуру на платформу виртуализации, пританцовывая джигу и напевая «Ah, du lieber Augustin…»
На самом деле нет — мы неохотно и осторожно — ну и консерваторы же эти сисадмины — стали пробовать что же это за зверь такой — виртуализация в отдельно взятой госконторе. По прошествии двух лет 70% нашей инфраструктуры сервис за сервисом переехали в кластер Vmware Vsphere и «волосы мои стали мягкими и шелковистыми». Хотелось бы поделиться плюсами и минусами виртуализации, ведь мне так не хватало этой статьи, когда я писал отчет по внедрению вышестоящим благодетелям, а кому-то она сохранит время. Можно было бы надеяться, что она подтолкнет к переходу много хороших админов, но давайте будем реалистами — порядок цен для создания безотказного кластера такой, что кому это по карману — у тех он давно есть, остальным же приходится только завидовать.&lt;/p&gt;
&lt;!-- PELICAN_END_SUMMARY --&gt;

&lt;p&gt;Итак &lt;strong&gt;плюсы&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;1.Простота и удобство администрирования виртуализированных сервисов и серверных приложений, которое достигается наличием инструментов создания новых гостевых операционных систем:&lt;/p&gt;
&lt;p&gt;-Миграция существующих серверов;&lt;/p&gt;
&lt;p&gt;-Разворачивание целевой системы из предварительно созданного шаблона;&lt;/p&gt;
&lt;p&gt;-Конвертирование из существующей резервной копии, созданной сторонними средствами;&lt;/p&gt;
&lt;p&gt;-Возможность сохранения состояния виртуальной машины позволяет быстро вернуться к точке до внесения изменений в систему. Весь зоопарк наших операционок — это каждая из семейства Windows Server от 2000 до 2012, а также большое количество сервисов на Linux (RHEL, Oracle Linux, etc..) беспроблемно переехали в кластер, не потеряв ни грана производительности. Созание новых гостевых машин производится двумя щелчками мыши.&lt;/p&gt;
&lt;p&gt;2.Возможность распределения вычислительных ресурсов кластера виртуализации между целевыми системами, таких как количество процессоров на виртуальную машину и количества ядер в них, количество выделяемой оперативной памяти и дисковое пространство разделов виртуальной машины. Следует отметить, операция добавления (или уменьшения) выделяемых виртуальной машине вычислительных ресурсов может производиться в оперативном порядке и занимает непродолжительное время.&lt;/p&gt;
&lt;p&gt;3.Наличие инструментов централизованного мониторинга состояния целевых систем, самого кластера виртуализации и распределяемых ресурсов, а также возможность создания отчетов мониторинга с диапазоном от одного дня до года.&lt;/p&gt;
&lt;p&gt;4.Инструменты кластера виртуализации обеспечивают централизованное создание резервных копий сервисов, баз данных и файлов виртуализированных серверов.&lt;/p&gt;
&lt;p&gt;5.Архитектура кластера виртуализации обеспечивает многократное резервирование программно-аппаратных ресурсов. Механизм автоматической балансировки вычислительных ресурсов внутри кластера виртуализации (Distributed Resource Scheduler – DRS) обеспечивает условия для создания не только отказоустойчивой, но и максимально производительной системы. Сочетание четырехкратного запаса аппаратных ресурсов и DRS создает очень надежную систему.&lt;/p&gt;
&lt;p&gt;6.Отмечено улучшение производительности виртуализированных сервисов, связанных с увеличением скорости доступа к дисковому пространству и оперативной памяти.&lt;/p&gt;
&lt;p&gt;7.Снижение энергопотребления и тепловыделения — еще бы, ведь три стойки доисторических серваков были заменены стойкой с блэйдами и дисковыми полками.&lt;/p&gt;
&lt;p&gt;А также &lt;strong&gt;минусы&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;1.Повышения требований к серверам, как по производительности, так и по надежности.&lt;/p&gt;
&lt;p&gt;2.Возможная единая точка отказа.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Резюме:&lt;/em&gt;&lt;/strong&gt; Виртуализация — отличная штука для продакшн-сервисов, где нужна быстрота деплоя, многочисленные эксперименты и удобство администрирования, однако критичные маломеняющиеся штуки все-таки стоит держать в железе (разумеется, в двойном экземпляре).&lt;/p&gt;</content><category term="Vmware"></category></entry><entry><title>RHEL 5.5 и fakeRAID</title><link href="fromer.ru/rhel-5-5-i-fakeraid.html" rel="alternate"></link><published>2012-12-17T12:48:00+04:00</published><updated>2012-12-17T12:48:00+04:00</updated><author><name>fr0mer</name></author><id>tag:None,2012-12-17:fromer.ru/rhel-5-5-i-fakeraid.html</id><summary type="html">&lt;p&gt;&lt;img alt="Rhel_sketch" src="fromer.ru/images/fakeraid.png"&gt;
 Вдруг кому пригодится. Появилась служебная надобность установить Enterprise RedHat Linux 5.5 на один из серверов. В этот погожий последневесенний денек ничто не предвещало беды, как вдруг…&lt;/p&gt;
&lt;!-- PELICAN_END_SUMMARY --&gt;

&lt;p&gt;Обо всем по порядку. Записав подходящий для архитектуры сервера образ &lt;strong&gt;RHEL 5.5 x86_64&lt;/strong&gt;, привычно выставив в BIOS’е загрузку с DVD-ROM, я …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="Rhel_sketch" src="fromer.ru/images/fakeraid.png"&gt;
 Вдруг кому пригодится. Появилась служебная надобность установить Enterprise RedHat Linux 5.5 на один из серверов. В этот погожий последневесенний денек ничто не предвещало беды, как вдруг…&lt;/p&gt;
&lt;!-- PELICAN_END_SUMMARY --&gt;

&lt;p&gt;Обо всем по порядку. Записав подходящий для архитектуры сервера образ &lt;strong&gt;RHEL 5.5 x86_64&lt;/strong&gt;, привычно выставив в BIOS’е загрузку с DVD-ROM, я увидел знакомый до боли интерфейс &lt;a href="http://fedoraproject.org/wiki/Anaconda/ru"&gt;Анаконды&lt;/a&gt;, не меняющийся даже не знаю сколько лет (внешне он остался на уровне, котором был еще в RedHat 7 в 2003 году ). Быстро пролистав стандартные вопросы инсталлера о языке системы, раскладки и прочего, я застопорился на разметке диска. Дело в том, что я точно знал — в сервере два SATA — диска по 250 Гб. Вместо этого редактор разделов &lt;strong&gt;Disk Druid&lt;/strong&gt; показывал мне устройство с очень странным именем &lt;strong&gt;&lt;em&gt;dev/mapper/isw_dahgehebjg_Volume0&lt;/em&gt;&lt;/strong&gt; и размером в 250 Гб. Это же ж RAID — подумал я и как ни в чем не бывало продолжил установку, хотя тень сомнения закралась ко мне в душу, уж слишком проста оказалась организация RAID. Запись загрузчика (на всё тот же загадочный диск), сетевые настройки, часовой пояс, пароль root’а, выбор пакетов и, вуаля, сервер перезагружается. Инициализация памяти, сканирование устройств и … Добрый день! &lt;strong&gt;«Error loading operating system».&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Тень сомнения превратилась в чёрную липкую лужу уверенности в том, что все будет не так легко, как думалось. Гугл — наше все, и, вооружившись названием материнской платы, я отправился искать информацию о RAID в интернете. Интернету порадовать меня было нечем: на Intel ICH7 отсутствовал аппаратный RAID, но был так называемый fakeRAID (псевдо-RAID, «полусофтовый»), не поддерживаемый ядром RHEL 5.5 (или CentOS 5.5). Будем делать RAID полностью программный, решил я и устремился. Отключил в BIOS’e формирование рэйда и установка ОС зашла на второй круг. Проклятый Disk Druid по прежнему показывал только одно устройство!&lt;/p&gt;
&lt;p&gt;Чувствуя себя препогано, я обратился с призывом о помощи в пустоту. Пустота ответила мне из чата &lt;a href="http://welinux.ru/"&gt;welinux&lt;/a&gt; голосом пользователя Settler (отзывчивого и доброго человека, по всей видимости). К тому моменту я возился с сервером 3 час в насквозь продуваемой всеми ветрами из 5 кондиционеров серверной. Направил меня мой спаситель на &lt;a href="http://www.linuxquestions.org/"&gt;буржуйский сайт&lt;/a&gt; , где предлагалось 2 способа решения данной проблемы:&lt;/p&gt;
&lt;p&gt;-выполнить команду &lt;strong&gt;&lt;em&gt;dd if=/dev/zero of=/dev/sda count=64&lt;/em&gt;&lt;/strong&gt;, что стирает первые 64 байта MBR и диск «забывает» о том, что он состоял в славном семействе близняшек RAID. Для моего случая данный рецепт не сработал (всего-то одна перезагрузка и я это выяснил);&lt;/p&gt;
&lt;p&gt;-выполнить команду &lt;strong&gt;&lt;em&gt;dmraid -r -E&lt;/em&gt;&lt;/strong&gt;, что «delete all of the raid data from the HDDs» — и это сработало! Я наконец-то увидел оба диска в редакторе дисков и успешно создал программный RAID. Небольшой хинт — в своих советах американцы говорят, что устанавливали «minimal linux» и выполнял данные команды из него, я же просто запустив Анаконду и дойдя до разметки диска, переключался во вторую консоль CTRL+ALT+F2 спокойно и смело вводил их прямо в процессе установки. Зло было побеждено, знамя добра в виде свеженького RHEL было водружено на дымящиеся останки fakeRAID, а я в очередной раз убедился в том, что мануалы следует читать ДО, а никак не ПОСЛЕ. &lt;strong&gt;RTFM&lt;/strong&gt;, это экономит нервы.&lt;/p&gt;
&lt;p&gt;P.S. Хочется еще раз поблагодарить пользователя Settler с конференции welinux за неоценимую помощь, оказанную очень кстати.&lt;/p&gt;</content><category term="Linux"></category><category term="Raid"></category><category term="RHEL"></category></entry></feed>